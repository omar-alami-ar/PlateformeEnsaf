@{
    ViewData["Title"] = "Home Page";
}

@functions{
    public string TimeAgo(DateTime dateTime)
    {
        string result = string.Empty;
        var timeSpan = DateTime.Now.Subtract(dateTime);

        if (timeSpan <= TimeSpan.FromSeconds(60))
        {
            result = string.Format("Il y a {0} secondes", timeSpan.Seconds);
        }
        else if (timeSpan <= TimeSpan.FromMinutes(60))
        {
            result = timeSpan.Minutes > 1 ?
                String.Format("Il y a {0} minutes", timeSpan.Minutes) :
                "Il y a une minute";
        }
        else if (timeSpan <= TimeSpan.FromHours(24))
        {
            result = timeSpan.Hours > 1 ?
                String.Format("Il y a {0} heures", timeSpan.Hours) :
                "Il y a une heure";
        }
        else if (timeSpan <= TimeSpan.FromDays(30))
        {
            result = timeSpan.Days > 1 ?
                String.Format("Il y a {0} jours", timeSpan.Days) :
                "Hier";
        }
        else if (timeSpan <= TimeSpan.FromDays(365))
        {
            result = timeSpan.Days > 30 ?
                String.Format("Il y a {0} mois", timeSpan.Days / 30) :
                "Il y a un mois";
        }
        else
        {
            result = timeSpan.Days > 365 ?
                String.Format("Il y a {0} ans", timeSpan.Days / 365) :
                "Il y a un an";
        }
        
        return result;
    }
}

<!-- Page Heading -->
<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Accueil</h1>
    <a asp-action="Report" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
        <i class="fas fa-download fa-sm text-white-50"></i> Generate Report
    </a>
</div>

<div class="row">

    <!-- Area Chart -->
    <div class="col-xl-8 col-lg-7">
        <div>
            <div class="card shadow gedf-card mb-3">
                <div class="card-header">
                    <ul class="nav nav-tabs card-header-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active show" id="posts-tab" data-toggle="tab" href="#posts" role="tab" aria-controls="posts" aria-selected="true">
                                Make
                                a publication
                            </a>
                        </li>
                        <li class="nav-item"> <a class="nav-link" id="images-tab" data-toggle="tab" role="tab" aria-controls="images" aria-selected="false" href="#images">Images</a></li>
                    </ul>
                </div><div class="card-body"><div class="tab-content" id="myTabContent"><div class="tab-pane fade active show" id="posts" role="tabpanel" aria-labelledby="posts-tab"><div class="form-group"> <label class="sr-only" for="message">post</label><textarea class="form-control" id="message" rows="3" placeholder="What are you thinking?"></textarea></div></div><div class="tab-pane fade" id="images" role="tabpanel" aria-labelledby="images-tab"><div class="form-group"><div class="custom-file"> <input type="file" class="custom-file-input" id="customFile"> <label class="custom-file-label" for="customFile">Upload image</label></div></div><div class="py-4"></div></div></div><div class="btn-toolbar justify-content-between"><div class="btn-group"> <button type="submit" class="btn btn-primary">share</button></div><div class="btn-group"> <button id="btnGroupDrop1" type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="fa fa-globe"></i> </button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="btnGroupDrop1"> <a class="dropdown-item" href="#"><i class="fa fa-globe"></i> Public</a> <a class="dropdown-item" href="#"><i class="fa fa-users"></i> Friends</a> <a class="dropdown-item" href="#"><i class="fa fa-user"></i> Just me</a></div></div></div></div>
            </div>
            @foreach (var annonce in ViewBag.annonces)
            {
                <div class="card shadow gedf-card mb-3">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="mr-2">
                                    @if (annonce.User.ProfilePicture != null)
                                    {
                                        <img class="rounded-circle" src="data:image/*;base64,@(Convert.ToBase64String(annonce.User.ProfilePicture))" alt="" width="45" height="45">
                                    }
                                    else
                                    {
                                        <img class="rounded-circle" src="~/img/undraw_profile.svg" alt="" width="45">
                                    }

                                </div><div class="ml-2"><a  asp-controller="Account" asp-action="Profile" asp-route-id="@annonce.User.Id" class="h5 m-0 text-muted">@annonce.User.FirstName @annonce.User.LastName</a><div class="h7 text-muted"><span>@@</span>@annonce.User.UserName</div></div>
                            </div><div><div class="dropdown"> <button class="btn btn-link dropdown-toggle" type="button" id="gedf-drop1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <i class="fa fa-ellipsis-h"></i> </button><div class="dropdown-menu dropdown-menu-right" aria-labelledby="gedf-drop1"><div class="h6 dropdown-header">Configuration</div> <a class="dropdown-item" href="#">Save</a> <a class="dropdown-item" href="#">Hide</a> <a class="dropdown-item" href="#">Report</a></div></div></div>
                        </div>
                    </div>
                    <div class="card-body">

                        <div class="text-muted h7 d-flex align-items-center justify-content-between mb-2">

                            <h5 class="card-link">@annonce.Categorie.ToString()</h5><h6>@TimeAgo(annonce.DatePublication)</h6>
                        </div>
                        <a class="card-link" href="#">
                            <h5 class="card-title">
                                @annonce.Titre
                            </h5>
                        </a><p class="card-text">
                            @annonce.Description
                        </p>
                        @if (annonce.Images.Count != 0)
                        {
                            @if (annonce.Images.Count == 1)
                            {
                                @foreach (var image in annonce.Images) {
                                <img src="data:image/*;base64,@(Convert.ToBase64String(image.Contenu))" class="img-responsive" width="200">
                                    }
                                }
                            else
                            {
                                <div class="d-flex">
                                    @foreach (var image in annonce.Images)
                                    {
                                        <img src="data:image/*;base64,@(Convert.ToBase64String(image.Contenu))" class="img-responsive mr-2" width="200">
                                    }
                    </div>
                            }
                        }
                        <div class="mt-2">
                            @foreach (var domaine in annonce.Annonce_Domaines)
                            {
                                <span class="badge badge-primary">@domaine.Domaine.Nom</span>
                            }

                        </div>
                    </div>
                    <div class="card-footer">
                        <a href="#" class="card-link"><i class="fa-solid fa-circle-up"></i> Upvote</a>
                        <a href="#" class="card-link"><i class="fa-solid fa-circle-down"></i> Downvote</a>
                        <a href="#" class="card-link"><i class="fa fa-comment"></i> Commenter</a>
                        <a href="#" class="card-link"><i class="fa fa-mail-forward"></i> Partager</a>
                    </div>
                </div>
            }
            
        </div>
        <!--<div class="card shadow mb-4">-->
        <!-- Card Header - Dropdown -->
        <!--<div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
            <h6 class="m-0 font-weight-bold text-primary">Nouvelles Annonces</h6>
            <div class="dropdown no-arrow">
                <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                </a>
                <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                     aria-labelledby="dropdownMenuLink">
                    <div class="dropdown-header">Dropdown Header:</div>
                    <a class="dropdown-item" href="#">Action</a>
                    <a class="dropdown-item" href="#">Another action</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#">Something else here</a>
                </div>
            </div>
        </div>-->
        <!-- Card Body -->
        <!--<div class="card-body">
                <div class="chart-area">
                    <canvas id="myAreaChart"></canvas>
                </div>
            </div>
        </div>-->
    </div>

    <!-- Pie Chart -->
    <div class="col-xl-4 col-lg-5">
        <div class="card shadow mb-4">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                <h6 class="m-0 font-weight-bold text-primary">Profils Intéressants</h6>
                <div class="dropdown no-arrow">
                    <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                       data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                    </a>
                    <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                         aria-labelledby="dropdownMenuLink">
                        <div class="dropdown-header">Dropdown Header:</div>
                        <a class="dropdown-item" href="#">Action</a>
                        <a class="dropdown-item" href="#">Another action</a>
                        <div class="dropdown-divider"></div>
                        <a class="dropdown-item" href="#">Something else here</a>
                    </div>
                </div>
            </div>
            <!-- Card Body -->
            <div class="card-body">
                <!-- Item 1-->
                @foreach (var user in ViewBag.People)
                {
                    <div class="d-flex align-items-center justify-content-between mb-4">
                        <div class="d-flex align-items-center flex-shrink-0 me-3">
                            @if (user.ProfilePicture != null)
                            {
                                <img class=" rounded-circle" src="data:image/*;base64,@(Convert.ToBase64String(user.ProfilePicture))" alt="" style="height:3rem; width:3rem; margin-right:1rem">
                            }
                            else
                            {

                                <img class=" rounded-circle" src="~/img/undraw_profile.svg" alt="" style="height:3rem; width:3rem; margin-right:1rem">
                            }
                            <div class="d-flex flex-column fw-bold">
                                <a class="text-dark line-height-normal mb-1" asp-controller="Account" asp-action="Profile" asp-route-id="@user.Id">@user.FirstName @user.LastName</a>
                                <div class="small text-muted line-height-normal">@user.Email</div>
                            </div>
                        </div>
                        <div class="dropdown no-arrow">
                            <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                               data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                            </a>
                            <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                                 aria-labelledby="dropdownMenuLink">
                                <div class="dropdown-header">Dropdown Header:</div>
                                <a class="dropdown-item" href="#">Action</a>
                                <a class="dropdown-item" href="#">Another action</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Something else here</a>
                            </div>
                        </div>
                    </div>
                }

            </div>
        </div>
    </div>
</div>
